(()=>{"use strict";const t=(()=>{const t={};return{subscribe:function(e,a){t[e]=t[e]||[],t[e].push(a)},publish:function(e,a){t[e]&&t[e].forEach((t=>{t(a)}))},unsubscribe:function(e,a){if(t[e])for(let n=0;n<t[e].length;n++)if(t[e][n]===a){t[e].splice(n,1);break}}}})(),e=function(e,a){let n=a?"Computer":"Player";return{opponentGameboard:e,playerName:n,attack:function(a,i){e.receiveAttack(a,i),t.publish(n+"Attacked",[a,i])}}};function a(){return[...new Array(10)].map((()=>[...new Array(10)].map((()=>null))))}const n=function(){let e=a(),n=[];function i(a,i,r,s,l=null){if(function(t,a,n,i){let r=!0;if(!0===i)for(let i=0;i<n;i++){if(t+i>9)return!1;r=r&&null===e[t+i][a]}else for(let i=0;i<n;i++){if(i+i>9)return!1;r=r&&null===e[t][a+i]}return r}(a,i,r,s)){let o=function(t){let e=t;return{shipLength:t,getHealth:function(){return e},hit:function(){e--},isSunk:function(){return 0==e}}}(r);if(n.push(o),!0===s)for(let t=0;t<r;t++)e[a+t][i]=o;else for(let t=0;t<r;t++)e[a][i+t]=o;let c=[a,i,r,s];return l&&(t.publish("Mark ship location",c),t.publish("RemoveShipFromOptions",l),5==n.length&&t.publish("AllShipsPlaced")),!0}return!1}function r(){e=a(),n=[]}return t.subscribe("StartNewGame",r),{placeShip:i,checkLocation:function(t,a){return e[t][a]},receiveAttack:function(t,a){e[t][a]?(e[t][a].hit(),e[t][a]=!0):null===e[t][a]&&(e[t][a]=!1)},allSunk:function(){return n.every((t=>t.isSunk()))},autoPlaceShip:function(){let t=[5,4,3,3,2];for(let r of t)do{var e=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());if(Math.floor(2*Math.random()))var n=!0;else n=!1}while(!i(e,a,r,n))},subscribeToShipPlacement:function(){t.subscribe("ResetShips",r),t.subscribe("Create ship",(function(t){let[e,a,n,r,s]=t;i(e,a,n,r,s)}))}}};function i(t){t.preventDefault()}function r(e){e.preventDefault();{var a;a="true"==e.dataTransfer.getData("isHorizontal");let r=parseInt(e.dataTransfer.getData("pos")),s=parseInt(e.dataTransfer.getData("length")),l=e.dataTransfer.getData("shipID");if(a){var n=parseInt(e.target.getAttribute("data-x"))-r,i=parseInt(e.target.getAttribute("data-y"));n>=0&&n<10&&n+s<=10&&i>=0&&i<10&&t.publish("Create ship",[n,i,s,a,l])}else n=parseInt(e.target.getAttribute("data-x")),i=parseInt(e.target.getAttribute("data-y"))-r,n>=0&&n<10&&i>=0&&i<10&&i+s<=10&&t.publish("Create ship",[n,i,s,a,l])}}function s(t){t.dataTransfer.setData("shipID",t.target.id),t.dataTransfer.setData("length",t.target.getAttribute("data-length")),t.dataTransfer.setData("pos",t.target.getAttribute("data-pos")),t.dataTransfer.setData("isHorizontal",t.target.getAttribute("data-isHorizontal"))}let l=[5,4,3,3,2],o=document.createElement("div");const c=()=>{o.classList.add("place-ships-container");let e=document.createElement("ul"),a=document.createElement("li"),n=document.createElement("li");a.textContent="Drag ships to place on grid.",n.textContent="Double click to rotate ships.",e.appendChild(a),e.appendChild(n),o.appendChild(e);for(let t=0;t<l.length;t++){let e=d(l[t],t);o.appendChild(e)}let i=document.createElement("div");return i.classList.add("button-container"),o.appendChild(i),function(t){let e=document.createElement("button");e.id="reset-placement-button",e.textContent="Reset Ships Placement",e.addEventListener("click",p),t.appendChild(e)}(i),t.subscribe("RemoveShipFromOptions",u),t.subscribe("AllShipsPlaced",(()=>{!function(e){let a=document.createElement("button");a.id="start-game-button",a.textContent="Start Game",a.addEventListener("click",(function(){t.publish("StartGame"),o.classList.add("hidden")})),e.appendChild(a)}(i)})),o};function d(t,e){let a=document.createElement("div");a.id="id"+e;for(let e=0;e<t;e++){let t=document.createElement("div");t.classList.add("ship-body"),t.addEventListener("mousedown",(function(){a.setAttribute("data-pos",e)})),a.appendChild(t)}return a.addEventListener("dragstart",s),a.addEventListener("dblclick",(function(){"true"==a.getAttribute("data-isHorizontal")?(a.setAttribute("data-isHorizontal","false"),a.style.flexDirection="column"):"false"==a.getAttribute("data-isHorizontal")&&(a.setAttribute("data-isHorizontal","true"),a.style.flexDirection="row")})),a.setAttribute("draggable","true"),a.setAttribute("data-isHorizontal","true"),a.setAttribute("data-length",t),a.classList.add("ship"+t),a.classList.add("ship"),a}function u(t){document.getElementById(t).style.display="none"}function p(){for(;o.firstChild;)o.firstChild.remove();c(),t.publish("ResetShips")}const f=c,h=function(e){let a=document.getElementById("container"),n=document.createElement("div");n.classList.add("board-container");let s=document.createElement("div");s.classList.add("board"),a.appendChild(n),n.appendChild(s);let l=function(e,a){let n=[];for(let s=0;s<10;s++){let l=[];for(let n=0;n<10;n++){let o=document.createElement("div");o.classList.add("game-cell"),e.appendChild(o),l.push(o),o.setAttribute("data-x",`${n}`),o.setAttribute("data-y",`${s}`),"Player"==a.playerName?(o.setAttribute("data-listener","true"),o.addEventListener("click",(function(){a.attack(n,s),t.publish("playerMadeMove"),o.setAttribute("data-listener","false")}),{once:!0})):"Computer"==a.playerName&&(o.addEventListener("dragover",i),o.addEventListener("drop",r))}n.push(l)}return n}(s,e);!function(e,a,n){"Computer"==e.playerName&&(a.append(f()),t.subscribe("Mark ship location",(function(t){let[e,a,i,r]=t,s="ship"+i;if(r)for(let t=e;t<e+i;t++)n[a][t].classList.add(s);else for(let t=a;t<a+i;t++)n[t][e].classList.add(s)})))}(e,n,l),t.subscribe("ResetShips",(function(){!function(e,a){let n=/ship[0-9]/;for(let i of e)for(let e of i)for(let i of e.classList)if(e.classList.remove("hit"),e.classList.remove("miss"),i.match(n)&&e.classList.remove(i),"Player"==a.playerName){let n=e.getAttribute("data-x"),i=e.getAttribute("data-y");"false"===e.getAttribute("data-listener")&&(e.setAttribute("data-listener","true"),e.addEventListener("click",(function(){a.attack(n,i),t.publish("playerMadeMove"),e.setAttribute("data-listener","false")}),{once:!0}))}}(l,e)})),function(e,a){let n=e.opponentGameboard;t.subscribe(e.playerName+"Attacked",(function(t){let e=t[0],i=t[1];!0===n.checkLocation(e,i)?a[i][e].classList.add("hit"):!1===n.checkLocation(e,i)&&a[i][e].classList.add("miss")}))}(e,l);let o=document.createElement("div");n.appendChild(o),o.classList.add("grid-title"),"Player"==e.playerName?(o.textContent="Computer's Grid",n.id="computer-grid",n.classList.add("hidden"),t.subscribe("StartGame",(function(){n.classList.remove("hidden")}))):(o.textContent="Player's Grid",n.id="player-grid"),function(e,a){t.subscribe("GameEnd",(function(){let t=document.createElement("div");t.classList.add("cover"),a.appendChild(t)}))}(0,a)};!function(){let a=n();a.subscribeToShipPlacement();let i=n(),r=e(i,!1),s=function(t,a){let n=Object.create(e(t,a));function i(e,a){return!0!==t.checkLocation(e,a)&&!1!==t.checkLocation(e,a)}return n.computerMakeMove=function(){do{var t=Math.floor(10*Math.random()),e=Math.floor(10*Math.random())}while(!i(t,e));n.attack(t,e)},n}(a,!0);(function(){let e=document.createElement("div"),a=document.getElementsByTagName("body")[0];e.id="container";let n=document.createElement("h1");n.textContent="Battleships",a.appendChild(n),a.appendChild(e);let i=function(){let e=document.createElement("div");e.classList.add("button-container"),e.classList.add("hidden");let a=document.createElement("button");return a.textContent="New Game",a.classList.add("new-game-button"),a.addEventListener("click",(function(){t.publish("StartNewGame"),e.classList.add("hidden")})),e.appendChild(a),e}();a.appendChild(i),t.subscribe("GameEnd",(function(){i.classList.remove("hidden")}))})(),h(r),h(s),i.autoPlaceShip(),t.subscribe("playerMadeMove",(function(){i.allSunk()?(t.publish("GameEnd"),alert("You won")):(s.computerMakeMove(),a.allSunk()&&(t.publish("GameEnd"),alert("You lost")))})),t.subscribe("StartNewGame",(function(){!function(t){document.querySelector(".place-ships-container").classList.remove("hidden"),p(),t.autoPlaceShip(),document.querySelector("#computer-grid").classList.add("hidden"),document.querySelectorAll(".cover").forEach((t=>t.remove()))}(i)}))}()})();